groups:
- name: example
  rules:
  # Alert for any filecoin node that is unreachable for >1 minute.
  - alert: containerAlert
    expr: absent(((time() - container_last_seen{image=~"657871693752.dkr.ecr.us-east-1.amazonaws.com/filecoin:.*"}) < 60))
    for: 1m 
    labels:
      severity: page
    annotations:
      summary: "filecoin node on {{ $labels.instance }} down"
      description: "file coin node on {{ $labels.instance }} of job {{ $labels.job }} has been down 1 minute."


  # Alert for any instance that has < 15% free memory
  - alert: nodeFreeMemoryAlert
    expr: (((node_memory_MemFree_bytes + node_memory_Cached_bytes) /node_memory_MemTotal_bytes) * 100) < 15
    for: 5m
    labels:
      severity: page
    annotations:
      summary: "Instance {{ $labels.instance }} running out of memory"
      description: "{{ $labels.instance }} of job {{ $labels.job }} has been using > 85% memory  for more than 5 minutes."


  # Alert for any instance that uses > 90% CPU
  - alert: nodeCpuUsageAlert
    expr: node_load1  / on(instance) machine_cpu_cores > 0.9
    for: 5m
    labels:
      severity: page
    annotations:
      summary: "Instance {{ $labels.instance }} high CPU usage"
      description: "{{ $labels.instance }} of job {{ $labels.job }} has been using > 90% CPU for more than 5 minutes."


  # Alert for any instance that uses > 80% disk space
  - alert: nodeDiskUsageAlert
    expr: node_filesystem_free_bytes{mountpoint="/etc/hostname"} /  node_filesystem_size_bytes{mountpoint="/etc/hostname"} < 0.2
    for: 5m
    labels:
      severity: page
    annotations:
      summary: "Instance {{ $labels.instance }} high root disk usage"
      description: "{{ $labels.instance }} of job {{ $labels.job }} has been using > 80% disk space for more than 5 minutes."

  # Alert for any instance that uses > 80% inodes 
  - alert: nodeDiskInodeUsageAlert
    expr: node_filesystem_files_free / node_filesystem_files{mountpoint="/etc/hostname"} < 0.2
    for: 5m
    labels:
      severity: page
    annotations:
      summary: "Instance {{ $labels.instance }} high root inode usage"
      description: "{{ $labels.instance }} of job {{ $labels.job }} has been using > 80% disk inodes for more than 5 minutes."





